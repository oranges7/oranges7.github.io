---
title: 常用函数
date: 2026-01-14
share: "true"
dir: post
image:
tags:
categories:
description:
math: flase
---
## 保存图片
使用r时画图很多时间想同时保存pdf和png，使用这个函数会比较方便的保存
```R
save_plots <- function(
    filename,      # 基础文件名(不含扩展名)
    plot,          # 要保存的图形对象(ggplot或grid对象)
    path = ".",    # 保存路径,默认当前目录
    width = 7.2,   # 宽度(英寸)
    height = 4.8,  # 高度(英寸)
    dpi = 600,     # PNG分辨率
    formats = c("pdf", "png")  # 支持保存的格式
) {
  library(ggplot2)
  library(grid)
  
  # 创建目录(如果不存在)
  if (!dir.exists(path)) {
    dir.create(path, recursive = TRUE)
  }
  
  # 判断是否为ggplot对象
  is_ggplot <- inherits(plot, "ggplot")
  
  # 遍历所有需要保存的格式
  for (fmt in formats) {
    full_path <- file.path(path, paste0(filename, ".", fmt))
    
    if (is_ggplot) {
      # 如果是ggplot对象,使用ggsave
      switch(fmt,
             "pdf" = ggsave(full_path, plot, width = width, height = height),
             "png" = ggsave(full_path, plot, width = width, height = height, dpi = dpi, bg = "white"),
             "tiff" = ggsave(full_path, plot, width = width, height = height, dpi = dpi, bg = "white"),
             warning(paste("Unsupported format:", fmt))
      )
    } else {
      # 如果是grid对象(如pheatmap),使用传统图形设备
      switch(fmt,
             "pdf" = {
               pdf(full_path, width = width, height = height)
               print(plot)
               dev.off()
             },
             "png" = {
               png(full_path, width = width * dpi, height = height * dpi, res = dpi, bg = "white")
               print(plot)
               dev.off()
             },
             "tiff" = {
               tiff(full_path, width = width * dpi, height = height * dpi, res = dpi, bg = "white")
               print(plot)
               dev.off()
             },
             warning(paste("Unsupported format:", fmt))
      )
    }
    
    message(paste("Saved:", full_path))
  }
  
  invisible(NULL)
}
```
需要保存时使用：
```R
save_plots(filename="00.VlnPlot", #图片名
           plot = v1, #要保存的对象名
           width = 7.9, 
           height = 4.75,
           path = "result" #保存的文件夹
)
```
## 色板
```R
mycol22 <- c("#b0d45d","#356d67","#42465c","#5066a1",
             "#76afda","#ffc556",
             "#f06152","#eb998b","#a14462","#cca69c",
             "#9e6c69","#7d4444","#562e3c","#a14462","#eb998b",
             "#fddbc8","#356d67","#4c9568",
             "#7fb961","#b0d45d","#ffe788",
             "#f06152","#7d4444","#9e6c69","#cca69c",
             "#5066a1","#76afda","#e8743c","#2873B3","#2EBEBE","#b20000","#74B346","#167153","#7D4444","#A14462","#8264CC",
             "#BD6263","#8EA325","#A9D179","#84CAC0","#F5AE6B","#BCB8D3","#4387B5",
             "#E64B35B2", "#4DBBD5B2" ,"#00A087B2", "#3C5488B2", "#F39B7FB2",
             "#8491B4B2", "#91D1C2B2", "#DC0000B2", "#7E6148B2",
             "#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2",
             "#D55E00", "#CC79A7",
             "#004529","#088247","#7CC767",
             "#223D6C","#5D90BA","#9ecae1",
             "#8c510a","#bf812d","#D8D155",
             "#b30000","#d73027","#fc9272",
             "#7A142C","#E0367A","#df65b0",
             "#4a1486","#6a51a3","#9e9ac8",
             "#252525","#737373","#bdbdbd")
mycol22 <- unique(mycol22)
```